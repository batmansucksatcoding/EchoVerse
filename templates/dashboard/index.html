{% extends 'base.html' %}

{% block title %}Dashboard - EchoVerse{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto space-y-10">
    
    <div class="relative overflow-hidden">
        <div class="glass-card p-8 sm:p-12">
            <div class="relative z-10">
                <h1 class="text-4xl sm:text-6xl font-bold glow-text mb-4 bg-gradient-to-r from-purple-400 via-pink-400 to-purple-400 bg-clip-text text-transparent animate-gradient">
                    Welcome back, {{ user.first_name|default:user.username }}! üëã
                </h1>
                <p class="text-gray-300 text-lg sm:text-xl max-w-2xl">
                    Your emotional universe is evolving. Here's what's happening in your journey.
                </p>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
        <div class="glass-card p-6 group hover:scale-105 transition-all duration-300 cursor-pointer relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-purple-500 rounded-full filter blur-3xl opacity-20 group-hover:opacity-30 transition-opacity"></div>
            <div class="relative z-10">
                <div class="flex items-start justify-between mb-4">
                    <div class="text-5xl group-hover:scale-110 transition-transform">üìù</div>
                    <span class="material-symbols-outlined text-purple-400 text-3xl">trending_up</span>
                </div>
                <p class="text-5xl font-bold mb-2 bg-gradient-to-br from-white to-purple-200 bg-clip-text text-transparent">{{ total_entries }}</p>
                <p class="text-gray-400 text-lg font-medium">Total Entries</p>
                <div class="mt-3 text-sm text-purple-300">
                    <span class="material-symbols-outlined text-xs mr-1">schedule</span>
                    Your emotional archive
                </div>
            </div>
        </div>

        <div class="glass-card p-6 group hover:scale-105 transition-all duration-300 cursor-pointer relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-orange-500 rounded-full filter blur-3xl opacity-20 group-hover:opacity-30 transition-opacity"></div>
            <div class="relative z-10">
                <div class="flex items-start justify-between mb-4">
                    <div class="text-5xl group-hover:scale-110 transition-transform">üî•</div>
                    <span class="material-symbols-outlined text-orange-400 text-3xl">local_fire_department</span>
                </div>
                <p class="text-5xl font-bold mb-2 bg-gradient-to-br from-white to-orange-200 bg-clip-text text-transparent">{{ current_streak }}</p>
                <p class="text-gray-400 text-lg font-medium">Day Streak</p>
                <div class="mt-3 text-sm text-orange-300">
                    <span class="material-symbols-outlined text-xs mr-1">bolt</span>
                    Keep the momentum going!
                </div>
            </div>
        </div>

        <div class="glass-card p-6 group hover:scale-105 transition-all duration-300 cursor-pointer relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-pink-500 rounded-full filter blur-3xl opacity-20 group-hover:opacity-30 transition-opacity"></div>
            <div class="relative z-10">
                <div class="flex items-start justify-between mb-4">
                    <div class="text-5xl group-hover:scale-110 transition-transform">üí≠</div>
                    <span class="material-symbols-outlined text-pink-400 text-3xl">psychology</span>
                </div>
                <p class="text-5xl font-bold mb-2 bg-gradient-to-br from-white to-pink-200 bg-clip-text text-transparent">{{ emotion_counts|length }}</p>
                <p class="text-gray-400 text-lg font-medium">Emotions Tracked</p>
                <div class="mt-3 text-sm text-pink-300">
                    <span class="material-symbols-outlined text-xs mr-1">sentiment_satisfied</span>
                    Unique feelings captured
                </div>
            </div>
        </div>
    </div>

    <div class="glass-card p-8 relative overflow-hidden">
        <div class="absolute top-0 left-0 w-64 h-64 bg-purple-500 rounded-full filter blur-3xl opacity-10"></div>
        
        <div class="relative z-10">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                <div>
                    <h2 class="text-3xl font-bold mb-2 flex items-center gap-3">
                        <span class="text-4xl">üé®</span>
                        Your Evolving Mood Blob
                    </h2>
                    <p class="text-gray-400">A visual representation of your emotional journey</p>
                </div>
                <a href="{% url 'blob_evolution' %}" 
                    class="btn-primary px-6 py-3 rounded-xl font-semibold flex items-center gap-2 relative z-10">
                    View Full Evolution
                    <span class="material-symbols-outlined">arrow_forward</span>
                </a>
            </div>

            {% if recent_viz.0 %}
            <div class="relative group cursor-pointer" onclick="window.location.href='{% url 'blob_evolution' %}'">
                <div class="glass-card p-4 hover:bg-white/10 transition-all duration-500">
                    <img src="{{ recent_viz.0.image.url }}" 
                            alt="Your Evolving Mood Blob" 
                            class="w-full rounded-xl shadow-2xl group-hover:scale-105 transition-transform duration-700"
                            style="animation: gentleFloat 8s ease-in-out infinite;">
                </div>
                <div class="absolute inset-0 bg-gradient-to-t from-purple-900/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-xl flex items-end justify-center pb-8">
                    <div class="text-center">
                        <p class="text-white text-2xl font-bold mb-2">Explore Your Evolution</p>
                        <p class="text-purple-200 text-sm">Click to see full timeline</p>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 flex items-center justify-between text-gray-400">
                <div class="flex items-center gap-2">
                    <span class="material-symbols-outlined text-sm">schedule</span>
                    <span>Last updated {{ recent_viz.0.created_at|timesince }} ago</span>
                </div>
                <div class="flex items-center gap-2 text-purple-300">
                    <span class="material-symbols-outlined text-sm animate-pulse">auto_awesome</span>
                    <span>Evolves with each entry</span>
                </div>
            </div>
            {% else %}
            <div class="text-center py-16">
                <div class="text-8xl mb-6 animate-bounce">üé®</div>
                <p class="text-2xl text-gray-300 mb-3 font-semibold">
                    Your blob awaits its first breath
                </p>
                <p class="text-gray-400 mb-8 max-w-md mx-auto">
                    Start your emotional journey and watch your unique blob come to life
                </p>
                <a href="{% url 'entry_create' %}" class="btn-primary inline-flex items-center gap-2 px-8 py-4 rounded-xl text-lg font-semibold relative z-10">
                    <span class="material-symbols-outlined">edit_note</span>
                    Create First Entry
                </a>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="glass-card p-8">
        <h2 class="text-3xl font-bold mb-6 flex items-center gap-3">
            <span class="material-symbols-outlined text-4xl text-purple-400">bolt</span>
            Quick Actions
        </h2>
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
            <a href="{% url 'entry_create' %}" 
                class="btn-primary p-6 rounded-xl text-center hover:scale-105 transition-all duration-300 group relative z-10">
                <div class="text-5xl mb-3 group-hover:scale-110 transition-transform">‚úçÔ∏è</div>
                <div class="text-xl font-semibold mb-2">New Entry</div>
                <p class="text-sm opacity-90">Evolve your blob</p>
            </a>
            
            <a href="{% url 'blob_evolution' %}" 
                class="glass-card p-6 rounded-xl text-center hover:scale-105 transition-all duration-300 group hover:bg-white/10">
                <div class="text-5xl mb-3 group-hover:scale-110 transition-transform">üé®</div>
                <div class="text-xl font-semibold mb-2">View Blob</div>
                <p class="text-sm text-gray-400">See evolution</p>
            </a>
            
            <a href="{% url 'generate_insight' %}" 
                class="glass-card p-6 rounded-xl text-center hover:scale-105 transition-all duration-300 group hover:bg-white/10">
                <div class="text-5xl mb-3 group-hover:scale-110 transition-transform">ü§ñ</div>
                <div class="text-xl font-semibold mb-2">AI Insight</div>
                <p class="text-sm text-gray-400">Get analysis</p>
            </a>
            
            <a href="{% url 'entry_list' %}" 
                class="glass-card p-6 rounded-xl text-center hover:scale-105 transition-all duration-300 group hover:bg-white/10">
                <div class="text-5xl mb-3 group-hover:scale-110 transition-transform">üìö</div>
                <div class="text-xl font-semibold mb-2">All Entries</div>
                <p class="text-sm text-gray-400">Browse history</p>
            </a>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        
        <div class="glass-card p-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-3xl font-bold flex items-center gap-3">
                    <span class="material-symbols-outlined text-4xl text-purple-400">history</span>
                    Recent Entries
                </h2>
                <a href="{% url 'entry_list' %}" class="text-purple-400 hover:text-purple-300 text-sm font-semibold flex items-center gap-1">
                    View All
                    <span class="material-symbols-outlined text-sm">arrow_forward</span>
                </a>
            </div>
            
            <div class="space-y-4 max-h-96 overflow-y-auto pr-2 custom-scrollbar"> 
                {% for entry in recent_entries %}
                <a href="{% url 'entry_detail' entry.pk %}" 
                    class="block p-5 glass-card hover:bg-white/10 transition-all duration-300 group hover:scale-[1.02]">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-1">
                            <h3 class="font-semibold text-lg group-hover:text-purple-400 transition mb-1">
                                {{ entry.title|default:"Untitled Entry" }}
                            </h3>
                            <p class="text-gray-400 text-sm flex items-center gap-2">
                                <span class="material-symbols-outlined text-xs">calendar_today</span>
                                {{ entry.created_at|date:"M d, Y - h:i A" }}
                            </p>
                        </div>
                        {% if entry.emotion_analysis %}
                        <div class="text-4xl group-hover:scale-125 transition-transform ml-4">
                            {% if entry.emotion_analysis.primary_emotion == 'joy' %}üòä
                            {% elif entry.emotion_analysis.primary_emotion == 'sadness' %}üò¢
                            {% elif entry.emotion_analysis.primary_emotion == 'anger' %}üò†
                            {% elif entry.emotion_analysis.primary_emotion == 'fear' %}üò®
                            {% elif entry.emotion_analysis.primary_emotion == 'love' %}‚ù§Ô∏è
                            {% elif entry.emotion_analysis.primary_emotion == 'anxiety' %}üò∞
                            {% elif entry.emotion_analysis.primary_emotion == 'excitement' %}ü§©
                            {% else %}üòê
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                    <p class="text-gray-300 line-clamp-2">{{ entry.preview }}</p>
                </a>
                {% empty %}
                <div class="text-center py-16">
                    <div class="text-7xl mb-4">üìù</div>
                    <p class="text-xl text-gray-300 mb-6">Your journey begins here</p>
                    <a href="{% url 'entry_create' %}" class="btn-primary inline-flex items-center gap-2 px-8 py-3 rounded-xl font-semibold relative z-10">
                        <span class="material-symbols-outlined">add_circle</span>
                        Write First Entry
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="glass-card p-8">
            <h2 class="text-3xl font-bold mb-6 flex items-center gap-3">
                <span class="material-symbols-outlined text-4xl text-pink-400">analytics</span>
                This Week's Emotions
            </h2>
            
            {% if emotion_counts %}
            <div class="space-y-5">
                {% for emotion, count in emotion_counts.items %}
                <div class="group hover:scale-105 transition-transform">
                    <div class="flex justify-between mb-2">
                        <span class="capitalize text-lg font-semibold flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-gradient-to-r from-purple-500 to-pink-500"></span>
                            {{ emotion }}
                        </span>
                        <span class="text-xl font-bold text-purple-300">{{ count }}</span>
                    </div>
                    <div class="w-full bg-gray-700/50 rounded-full h-3 overflow-hidden">
                        <div class="bg-gradient-to-r from-purple-500 via-pink-500 to-purple-500 h-3 rounded-full transition-all duration-700 group-hover:animate-pulse" 
                                style="width: {% widthratio count 10 100 %}%; background-size: 200% 200%; animation: gradient 3s ease infinite;">
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-16">
                <div class="text-7xl mb-4">üí≠</div>
                <p class="text-xl text-gray-300 mb-3">No emotions tracked yet</p>
                <p class="text-gray-400 max-w-sm mx-auto">
                    Start writing entries to see your emotional patterns emerge
                </p>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="glass-card p-8">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold flex items-center gap-3">
                <span class="material-symbols-outlined text-4xl text-blue-400">smart_toy</span>
                AI Insights
            </h2>
            <a href="{% url 'insights' %}" class="text-purple-400 hover:text-purple-300 font-semibold flex items-center gap-1">
                View All
                <span class="material-symbols-outlined">arrow_forward</span>
            </a>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            {% for insight in recent_insights %}
            <a href="{% url 'insight_detail' insight.pk %}" 
                class="glass-card p-6 hover:bg-white/10 transition-all duration-300 hover:scale-105 group">
                <div class="flex items-start gap-3 mb-3">
                    <span class="material-symbols-outlined text-3xl text-blue-400 group-hover:scale-110 transition-transform">lightbulb</span>
                    <div class="flex-1">
                        <h3 class="font-semibold text-lg mb-1 group-hover:text-purple-400 transition">{{ insight.title }}</h3>
                        <p class="text-gray-400 text-sm flex items-center gap-1">
                            <span class="material-symbols-outlined text-xs">schedule</span>
                            {{ insight.generated_at|date:"M d, Y" }}
                        </p>
                    </div>
                </div>
            </a>
            {% empty %}
            <div class="col-span-3 text-center py-16">
                <div class="text-7xl mb-4">ü§ñ</div>
                <p class="text-xl text-gray-300 mb-3">No AI insights yet</p>
                <p class="text-gray-400 mb-6 max-w-md mx-auto">
                    Generate your first insight to discover patterns in your emotional journey
                </p>
                <a href="{% url 'generate_insight' %}" class="btn-primary inline-flex items-center gap-2 px-8 py-3 rounded-xl font-semibold relative z-10">
                    <span class="material-symbols-outlined">auto_awesome</span>
                    Generate Insight
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<style>
@keyframes gentleFloat {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-10px) rotate(1deg); }
}

@keyframes gradient {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

.animate-gradient {
    background-size: 200% 200%;
    animation: gradient 4s ease infinite;
}

/* Custom Scrollbar Styles for Dark Mode (Webkit browsers: Chrome, Edge, Safari) */
.custom-scrollbar::-webkit-scrollbar {
    width: 8px; /* Width of the scrollbar */
}

.custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: rgba(147, 51, 234, 0.5); /* Purple-600 with transparency */
    border-radius: 10px; /* Rounded corners */
    border: 2px solid transparent; /* Padding around the thumb */
    background-clip: padding-box; /* Ensures border doesn't cover the background */
}

.custom-scrollbar::-webkit-scrollbar-track {
    background: transparent; /* Makes the track invisible */
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: rgba(147, 51, 234, 0.8); /* Darker purple on hover */
}
</style>
{% endblock %}