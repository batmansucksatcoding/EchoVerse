{% extends 'base.html' %}
{% block title %}{% if entry %}Edit Entry{% else %}New Entry{% endif %} - EchoVerse{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto py-12">
    <div class="glass-card p-10 rounded-2xl shadow-lg">
        
        <!-- Header -->
        <div class="mb-10 text-center">
            <h1 class="text-4xl font-bold glow-text mb-3 tracking-tight">
                {% if entry %}âœï¸ Edit Your Thoughts{% else %}âœï¸ New Journal Entry{% endif %}
            </h1>
            <p class="text-gray-400 text-base">
                Take a deep breath and write whatâ€™s on your mind â€” your space is safe here.
            </p>
        </div>
        
        <!-- Form -->
        <form method="post" class="space-y-8">
            {% csrf_token %}
            
            <!-- Title -->
            <div>
                <label for="title" class="block text-sm font-medium mb-2 text-gray-300">
                    Entry Title (optional)
                </label>
                <input 
                    type="text" 
                    name="title" 
                    id="title"
                    value="{% if entry %}{{ entry.title }}{% endif %}"
                    placeholder="Something that captures your day..."
                    class="w-full px-4 py-3 bg-white bg-opacity-10 border border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 transition"
                >
            </div>
            
            <!-- Content -->
            <div>
                <label for="content" class="block text-sm font-medium mb-2 text-gray-300">
                    Your Journal Entry <span class="text-red-400">*</span>
                </label>
                <textarea 
                    name="content" 
                    id="content"
                    rows="14"
                    required
                    placeholder="Pour your heart out... Write honestly. The AI will listen, not judge."
                    class="w-full px-4 py-4 bg-white bg-opacity-10 border border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-y leading-relaxed"
                >{% if entry %}{{ entry.content }}{% endif %}</textarea>
                <p class="text-sm text-gray-500 mt-3 italic">
                    ğŸ’¡ Tip: Donâ€™t filter yourself â€” your emotions make the story real.
                </p>
            </div>

            <!-- Word Count -->
            <div class="flex justify-between items-center text-sm mt-2">
                <span id="wordCount" class="text-gray-400">0 words</span>
                <span class="text-gray-500">Minimum 10 words recommended</span>
            </div>

            <!-- Buttons -->
            <div class="flex justify-between items-center pt-8 border-t border-gray-700 mt-10">
                <a href="{% if entry %}{% url 'entry_detail' entry.pk %}{% else %}{% url 'dashboard' %}{% endif %}" 
                   class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg transition text-gray-200 font-medium">
                    â† Cancel
                </a>
                
                <button 
                    type="submit"
                    class="btn-primary px-8 py-3 rounded-lg font-semibold flex items-center space-x-2 shadow-md hover:scale-105 transition"
                >
                    <span>{% if entry %}ğŸ’¾ Update Entry{% else %}âœ¨ Save & Analyze{% endif %}</span>
                </button>
            </div>
        </form>

        <!-- Process Explanation -->
        <div class="mt-14 p-8 rounded-2xl bg-white bg-opacity-5 border border-gray-700">
            <h3 class="text-xl font-semibold mb-4">ğŸ¯ What Happens Next</h3>
            <ul class="space-y-2 text-gray-300 text-sm list-disc list-inside">
                <li>Your entry is securely stored and analyzed by our emotion engine.</li>
                <li>The AI identifies emotional tone and key moods.</li>
                <li>Youâ€™ll receive visual and narrative feedback on your growth.</li>
                <li>All insights remain private and tied only to your journey.</li>
            </ul>
        </div>

    </div>
</div>

<!-- Scripts -->
<script>
const textarea = document.getElementById('content');
const wordCountDisplay = document.getElementById('wordCount');

function updateWordCount() {
    const text = textarea.value.trim();
    const words = text.length > 0 ? text.split(/\s+/).length : 0;
    wordCountDisplay.textContent = `${words} word${words !== 1 ? 's' : ''}`;

    // Color shift for progress
    if (words < 10) {
        wordCountDisplay.className = 'text-red-400';
    } else if (words < 50) {
        wordCountDisplay.className = 'text-yellow-400';
    } else {
        wordCountDisplay.className = 'text-green-400';
    }
}

textarea.addEventListener('input', updateWordCount);
updateWordCount();

// Unsaved changes warning
let hasChanges = false;
textarea.addEventListener('input', () => { hasChanges = true; });
window.addEventListener('beforeunload', (e) => {
    if (hasChanges) {
        e.preventDefault();
        e.returnValue = '';
    }
});
document.querySelector('form').addEventListener('submit', () => { hasChanges = false; });
</script>
{% endblock %}
